/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
	id 'java'
	id 'com.github.mirofff.java-application-conventions'
	id "com.google.protobuf" version "0.9.4"

	id 'com.diffplug.spotless' version '6.23.2'
}

sourceSets {
	main {
		proto {
			srcDir 'src/main/protos'
		}
		java {
			srcDirs 'build/generated/source/proto/main/grpc'
			srcDirs 'build/generated/source/proto/main/java'
		}
	}
}

protobuf {
	protoc {
		artifact = 'com.google.protobuf:protoc:3.0.0'
	}
	plugins {
	// Optional: an artifact spec for a protoc plugin, with "grpc" as
	// the identifier, which can be referred to in the "plugins"
	// container of the "generateProtoTasks" closure.
		grpc {
			artifact = 'io.grpc:protoc-gen-grpc-java:1.15.1'
		}
	}
	generateProtoTasks {
		ofSourceSet('main').configureEach {
			plugins {
				grpc {}
			}
		}
	}
}

spotless {
	format 'misc', {
		target '*.gradle', '.gitattributes', '.gitignore'

		trimTrailingWhitespace()
		indentWithTabs()
		endWithNewline()
	}

	java {
		importOrder 'java', 'javax', 'org', 'com', 'com.diffplug', ''

		target  	'src/*/java/**/*.java'
		target 'build/generated/source/**/*.java'

		removeUnusedImports()

		googleJavaFormat('1.18.1').reflowLongStrings().skipJavadocFormatting()
		formatAnnotations()
	}
}

dependencies {
	implementation 'org.apache.commons:commons-text'

	if (JavaVersion.current().isJava9Compatible()) {
		// Workaround for @javax.annotation.Generated
		// see: https://github.com/grpc/grpc-java/issues/3633
		implementation 'javax.annotation:javax.annotation-api:1.3.2'
	}

	implementation 'com.google.protobuf:protobuf-java:3.6.1'
	implementation 'io.grpc:grpc-stub:1.15.1'
	implementation 'io.grpc:grpc-protobuf:1.15.1'
	implementation 'io.grpc:grpc-services:1.59.1'

	implementation 'com.google.googlejavaformat:google-java-format:1.18.1'

	implementation project(':utilities')
	implementation project(':usefull')

	runtimeOnly 'io.grpc:grpc-netty-shaded:1.59.1'
}

application {
	// Define the main class for the application.
	mainClass = 'com.github.mirofff.app.App'
}
